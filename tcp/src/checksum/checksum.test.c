#include "./checksum.h"
#include <assert.h>
#include <stdint.h>
#include <string.h>

void checksum_test(void) {
  uint32_t source_ip = (192U << 24) | (168U << 16) | (174U << 8) | 128;
  uint32_t dest_ip = (192U << 24) | (168U << 16) | (174U << 8) | 1;
  uint16_t data_len = 0x26;
  uint8_t data[0x26] = {
      0x11, 0x5c, 0xdc, 0xba, 0x28, 0xd5, 0x41, 0xda, 0x64, 0xe8,
      0x6a, 0x10, 0x80, 0x18, 0x01, 0xfe, 0x00, 0x00, 0x00, 0x00,
      0x01, 0x01, 0x08, 0x0a, 0x5c, 0x86, 0xc6, 0xf8, 0xbd, 0x62,
      0xe3, 0x6f, 0x6c, 0x69, 0x64, 0x6f, 0x72, 0x0a,
  };
  uint16_t checksum = compute_checksum(source_ip, dest_ip, data, data_len);
  uint8_t expected_checksum[2] = {0x67, 0xea};
  assert(memcmp(&checksum, expected_checksum, 2) == 0);
}
